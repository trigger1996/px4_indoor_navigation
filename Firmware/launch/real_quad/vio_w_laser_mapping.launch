<launch>
    <!-- vim: set ft=xml noet : -->
	
    <arg name="fcu_url" default="/dev/ttyUSB0:921600" />
    <arg name="gcs_url" default="" />
    <arg name="tgt_system" default="1" />
    <arg name="tgt_component" default="1" />
    <arg name="log_output" default="screen" />
    <arg name="fcu_protocol" default="v2.0" />
    <arg name="respawn_mavros" default="false" />

    <include file="$(find px4)/launch/real_quad/module_tests/node.launch">
          <arg name="pluginlists_yaml" value="$(find px4)/launch/real_quad/module_tests/configs/px4_pluginlists.yaml" />
          <arg name="config_yaml" value="$(find px4)/launch/real_quad/module_tests/configs/px4_config.yaml" />

          <arg name="fcu_url" value="$(arg fcu_url)" />
          <arg name="gcs_url" value="$(arg gcs_url)" />
          <arg name="tgt_system" value="$(arg tgt_system)" />
          <arg name="tgt_component" value="$(arg tgt_component)" />
          <arg name="log_output" value="$(arg log_output)" />
          <arg name="fcu_protocol" value="$(arg fcu_protocol)" />
          <arg name="respawn_mavros" default="$(arg respawn_mavros)" />
    </include>

    <!-- Rplidar Driver -->
    <node name="rplidarNode"          pkg="rplidar_ros"  type="rplidarNode" output="screen">
         <param name="serial_port"         type="string" value="/dev/ttyUSB1"/>
         <param name="serial_baudrate"     type="int"    value="115200"/><!--A1/A2 -->
         <!--param name="serial_baudrate"     type="int"    value="256000"--><!--A3 -->
         <param name="frame_id"            type="string" value="laser"/>
         <param name="inverted"            type="bool"   value="false"/>
         <param name="angle_compensate"    type="bool"   value="true"/>
     </node>


    <!-- Cartographer SLAM -->
    <param name="/use_sim_time" value="false" />
    <node name="cartographer_node"
          pkg="cartographer_ros"
          type="cartographer_node"
          args="-configuration_directory $(find px4)/launch/real_quad/module_tests/configs -configuration_basename rplidar_real.lua"
          output="screen">
    </node>
    <node name="cartographer_occupancy_grid_node"
          pkg="cartographer_ros"
          type="cartographer_occupancy_grid_node" />
    <node name="robot_pose_publisher"
          pkg="robot_pose_publisher"
          type="robot_pose_publisher"
          respawn="false"
          output="screen" >
          <!--remap from="/robot_pose" to="/mavros/vision_pose/pose" /-->
    </node>

    <!-- Camera Driver -->
    <node name="px4_indoor_cam_driver"
          pkg="px4_indoor"
          type="px4_indoor_cam_driver"
          args=""
          output="screen">
        <param name="is_show_img"       type="bool"    value="false" />
        <param name="is_calculate_fps"  type="bool"    value="false" />
        <param name="resolution_x"      type="int"     value="1280" />
        <param name="resolution_y"      type="int"     value="960" />
        <param name="image_left_topic"  type="string"  value="/gi/simulation/left/image_raw" />
        <param name="image_right_topic" type="string"  value="/gi/simulation/right/image_raw" />
    </node>

    <!-- VSLAM -->
    <node name="Real_VSLAM_ros"
          pkg="px4_indoor"
          type="Real_VSLAM_ros"
          args="$(find px4_indoor)/src/ygz_slam_ros/examples/real_stereo.yaml ~/catkin_ws/logs/vslam.log"
          output="screen">
	  <param name="is_logging_info"    type="int" value="0" />
          <param name="is_logging_warning" type="int" value="0" /> 
    </node>

    <!-- Message Relay -->
    <!--node name="px4_indoor_topic_relay_real_quad"
          pkg="px4_indoor"
          type="px4_indoor_topic_relay_real_quad"
          args=""
          output="screen">
          <param name="is_use_vslam_data" type="int" value="1" /> 
    </node-->

    <!-- TF -->
    <node pkg="tf" type="static_transform_publisher" name="base_to_laser_broadcaster" args="0 0 0 0 0 0 base_link laser 100" />

    <!-- RVIZ -->
    <node name="rviz" pkg="rviz" type="rviz" required="true"
          args="-d $(find px4)/launch/real_quad/module_tests/configs/rplidar_cartographer.rviz" >
    </node>

</launch>
